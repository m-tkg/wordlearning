{% csrf_token %}
<script type="text/javascript">
$(document).ready(function() {
    $('table tr').click(function() {
        var $c = $(this).children('td').children('input[type=checkbox]');
        if($c.prop('checked')){
            $c.parent().parent().removeClass("success");
            $c.prop('checked', '');
        }else{
            $c.parent().parent().addClass("success");
            $c.prop('checked', 'checked');
        }
        updatebutton();
    });
    applycookie();
});
function updatelist(status, obj) {
    status = status.replace(' ', '_')
    if(obj.checked == true){
        document.cookie = status + '=true';
        $('.class' + status).show();
    }else{
        document.cookie = status + '=false';
        $('.class' + status).hide();
        $('.class' + status).removeClass("success");
        $.each($('.class' + status).find('input[type=checkbox]'), function(i, e){e.checked=false})
    }
    updatebutton();
}
function updatebutton(){
    if($('tbody').find('.success').length == 0)
        $('#statusdropdown').addClass('disabled')
    else
        $('#statusdropdown').removeClass('disabled')
}
function applycookie(){
    for( keyvalue of document.cookie.split('; ')){
        cookie = keyvalue.split( '=' );
        status = cookie[0].replace('_', ' ');
        {% for status, name in wordstatus %}
            if( status == '{{ status }}' ){
                $('#checkbox{{ forloop.counter }}').prop('checked', eval(cookie[1]))
                if(cookie[1] == 'false')
                    $('.class' + cookie[0]).hide();
            }
        {% endfor %}
    }
}
</script>
<input type="hidden" name="change_status" id="change_status" value=""/>
<div class="input-group">
    <button type="submit" id="statusdropdown" class="btn btn-default dropdown-toggle btn-xs disabled" data-toggle="dropdown" aria-expanded="false">
        Change status
        <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
        {% for status, name in wordstatus %}
            <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:$('#change_status').val('{{ status }}'); $('#wordform').submit()">to '{{ status }}'</a></li>
        {% endfor %}
	</ul>
    <br/>
    {% for status, label in wordstatus %}
        <label class='checkbox-inline'><input type="checkbox" id='checkbox{{ forloop.counter }}' checked onchange="updatelist('{{ status }}', this)"><span class="label label-{{ label }}">{{ status }}</span></label>
    {% endfor %}
</div>
<br/>
<table class="table table-bordered">
    <tbody>
        {% for word in words %}
        <tr class="check{{word.id}} class{{word.statuslabel}}">
            <td class="list-group-item">
                    <input clas="wordcheck" type="checkbox" value="{{word.id}}" id="check{{word.id}}" name="check" style="display: none"/>&nbsp;
                {% for status, label in wordstatus %}
                    {% if status == word.status %}
                        <span class="label label-{{ label }}">{{ status }}</span>
                    {% endif %}
                {% endfor %}
                {% if word.meaning == '' %}
                {{ word.word }}
                {% else %}
                <a href="/words/view?id={{ word.id }}">{{ word.word }}</a>
                {% endif %}
                {% if word.imageurl %}
                <span class="glyphicon glyphicon-picture"></span>
                {% endif %}
                <span class="badge">{{ word.cnt }}</span>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
